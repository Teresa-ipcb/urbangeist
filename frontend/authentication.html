<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>UrbanGeist</title>
    <link rel="stylesheet" href="authentication.css">
</head>
<body>
<header class="header">
    <nav>
        <div class="nav-title">
            <h2><a href="../index.html">UrbanGeist <img src="images/map.png" class="header-imgs" alt="icon"></a></h2>
        </div>
        <div class="nav-links">
            <ul>
                <li><a href="authentication.html"><img src="images/perfil.png" class="header-imgs" alt="Perfil"></a></li>
            </ul> 
        </div>
    </nav>
    <hr>
</header>

<div class="top-container">
    <h2 id="purposeDescription">INICIAR SESSÃO</h2>
    <div class="autenticacao">
        <div id="div_login">
            <main class="login-conteudo">
                <div class="login-conteudo-principal">
                    <form class="login-conteudo-informacoes">
                        <div class="login-conteudo-email">
                            <label>Email:</label>
                            <input type="email" id="email" class="inputData" />
                        </div>
                        <div class="login-conteudo-password">
                            <label>Password:</label>
                            <input type="password" id="password" class="inputData" />
                        </div>
                        <div class="login-conteudo-botoes">
                            <input type="button" value="Entrar" id="btn_login" onclick="login()" />
                        </div>
                        <p id="output"></p>
                    </form>
                </div>
            </main>
        </div>

        <div id="div_new">
            <div class="register">
                <h2>Novo Cliente?</h2>
                <form class="login-conteudo-informacoes" style="margin-left: 26%; margin-top: 7%;">
                    <div class="login-conteudo-nome">
                        <label>Nome: *</label>
                        <input type="text" id="pNome" class="inputData" required />
                    </div>
                    <div class="login-conteudo-email">
                        <label>Email: *</label>
                        <input type="email" id="emailR" class="inputData" required />
                    </div>
                    <div class="login-conteudo-password">
                        <label>Password: *</label>
                        <input type="password" id="passwordR" class="inputData" required />
                    </div>
                    <div class="login-conteudo-botoes">
                        <input type="button" value="Criar" id="btn_criar" />
                    </div>
                </form>
                <p id="output"></p>
            </div>
        </div>
    </div>
</div>

<footer class="footer">
    <h4>UrbanGeist</h4>
    <p>© 2025 UrbanGeist, Todos os direitos reservados</p>
    <div class="nav-footer">
        <ul>
            <li><a href="../index.html">Home</a></li>
            <li><a href="about.html">Sobre Nós</a></li>
        </ul>
    </div>
</footer>

<script>
document.getElementById("btn_criar").addEventListener("click", async function () {
    const nome = document.getElementById("pNome").value;
    const email = document.getElementById("emailR").value;
    const password = document.getElementById("passwordR").value;

    try {
        const response = await fetch("https://urbangeist-function.azurewebsites.net/api/utilizadores", {
            method: "POST",
            headers: { 
                "Content-Type": "application/json",
                "Accept": "application/json"
            },
            body: JSON.stringify({ nome, email, password })
        });

        const data = await response.text(); // Primeiro leia como texto
        
        if (response.ok) {
            localStorage.setItem("user_email", email);
            window.location.href = "formPerguntas.html";
        } else {
            try {
                // Tente parsear como JSON se for possível
                const errorData = JSON.parse(data);
                alert(`Erro: ${errorData.body || errorData.message || 'Erro desconhecido'}`);
            } catch {
                alert(`Erro: ${data || 'Erro ao criar utilizador'}`);
            }
        }
    } catch (error) {
        console.error("Erro:", error);
        alert("Erro de conexão com o servidor. Verifique o console para mais detalhes.");
    }
});
</script>


<script>
    async function login() {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
    
        const response = await fetch('https://your-function.azurewebsites.net/api/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password }),
            credentials: 'include' 
        });
    
        if (response.ok) {
            window.location.href = 'index.html';
        } else {
            alert('Login falhou!');
        }
    }
</script>
</body>
</html>
